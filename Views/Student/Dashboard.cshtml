@model UniversityApp.Models.StudentDashboardViewModel
@{
    Layout = "_Layout";
    ViewData["Title"] = "Student Dashboard";
    string activeTab = ViewBag.ActiveTab ?? "classes";
}



<div class="container mt-4">
    <h2>Student Dashboard</h2>

    <!-- Tabs -->
    <ul class="nav nav-tabs">
        <li class="nav-item">
            <button class="nav-link @(activeTab != "personal" && activeTab != "classesToEnroll" ? "active" : "")"
                    data-bs-toggle="tab" data-bs-target="#classes" type="button">
                Classes & Grades
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link @(activeTab == "personal" ? "active" : "")"
                    data-bs-toggle="tab" data-bs-target="#personal" type="button">
                Personal Info
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link @(activeTab == "classesToEnroll" ? "active" : "")"
                    data-bs-toggle="tab" data-bs-target="#available" type="button">
                Classes to Enroll
            </button>
        </li>
    </ul>

    <div class="tab-content mt-3">

        <!-- Classes & Grades -->
        <div class="tab-pane fade @(activeTab != "personal" && activeTab != "classesToEnroll" ? "show active" : "")" id="classes">
            <table class="table table-bordered">
                <thead>
                    <tr><th>Class</th><th>Grade</th></tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.ClassesAndGrades)
                    {
                        <tr>
                            <td>@item.ClassName</td>
                            <td>@(item.Grade.HasValue? item.Grade.ToString() : "Not graded yet")</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Personal Info -->
        <div class="tab-pane fade @(activeTab == "personal" ? "show active" : "")" id="personal">
            <form method="post" asp-action="Dashboard" asp-controller="Student">
                @Html.AntiForgeryToken() <!-- So personal info doesnt get deleted -->
                <input type="hidden" name="StudentId" value="@Model.StudentId" />
                <input type="hidden" name="FormType" value="PersonalInfo" />
                <input type="hidden" name="activeTab" value="personal" />

                <dl class="row">
                    <dt class="col-sm-3">Index</dt>
                    <dd class="col-sm-9">@Model.Index</dd>

                    <dt class="col-sm-3">Name</dt>
                    <dd class="col-sm-9">@Model.Name</dd>

                    <dt class="col-sm-3">Surname</dt>
                    <dd class="col-sm-9">@Model.Surname</dd>

                    <dt class="col-sm-3">Date of Birth</dt>
                    <dd class="col-sm-9">@Model.DateOfBirth.ToShortDateString()</dd>

                    <dt class="col-sm-3">Address</dt>
                    <dd class="col-sm-9">
                        <input type="text" class="form-control" name="Address" value="@Model.Address" />
                    </dd>

                    <dt class="col-sm-3">City</dt>
                    <dd class="col-sm-9">
                        <input type="text" class="form-control" name="City" value="@Model.City" />
                    </dd>

                   
                    <dt class="col-sm-3">Email</dt>
                    <dd class="col-sm-9">
                        <input type="text" class="form-control @(ViewData.ModelState["Email"]?.Errors.Count > 0 ? "is-invalid" : "")"
                               name="Email" value="@Model.Email" />
                        <span class="text-danger">
                            @Html.ValidationMessage("Email")
                        </span>
                    </dd>

                
                    <dt class="col-sm-3">Phone</dt>
                        <dd class="col-sm-9">
                            <input type="text" class="form-control @(ViewData.ModelState["Phone"]?.Errors.Count > 0 ? "is-invalid" : "")" 
                                   name="Phone" value="@Model.Phone" />
                        <span class="text-danger" id="phoneError">
                                @Html.ValidationMessage("Phone")
                            </span>
                        </dd>
                </dl>

                <button type="submit" class="btn btn-success mt-3">Save</button>

            </form>
        </div>

        <!-- Classes to Enroll -->
        <div class="tab-pane fade @(activeTab == "classesToEnroll" ? "show active" : "")" id="available">
            <table class="table table-bordered">
                <thead>
                    <tr><th>Class</th><th>Semester</th><th>Professor</th><th>Action</th></tr>
                </thead>
                <tbody>
                    @foreach (var c in Model.AvailableClasses)
                    {
                        <tr>
                            <td>@c.ClassName</td>
                            <td>@c.Semester</td>
                            <td>@c.Professor</td>
                            <td>
                                @* <form method="post" asp-action="Enroll" asp-controller="Student"> *@
                                <form method="post" action="/Student/Enroll">
                                    @Html.AntiForgeryToken() <!-- So personal info doesnt get deleted -->
                                    <input type="hidden" name="studentId" value="@Model.StudentId" />
                                    <input type="hidden" name="classId" value="@c.ClassId" />

                                  
                                    <button type="submit" class="btn btn-primary btn-sm">Enroll</button>
                                </form>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

    </div>
</div>


@* <script>
    const emailInput = document.querySelector('input[name="Email"]');
    const saveButton = document.getElementById('saveButton');
    const emailError = document.getElementById('emailError');

    function validateEmail() {
        const email = emailInput.value.trim();
        const valid = email.endsWith("@@gmail.com") || email.endsWith("@@yahoo.com");

        if (!valid) {
            emailError.style.display = "block";
            saveButton.disabled = true;
        } else {
            emailError.style.display = "none";
            saveButton.disabled = false;
        }
    }

    // Validate on page load and on every input
    validateEmail();
    emailInput.addEventListener('input', validateEmail);
</script> *@
<script>
    const emailInput = document.querySelector('input[name="Email"]');
    const phoneInput = document.querySelector('input[name="Phone"]');
    const saveButton = document.getElementById('saveButton');
    const phoneError = document.getElementById('phoneError');

    function validateForm() {
        const email = emailInput.value.trim();
        const phone = phoneInput.value.replace(/\s+/g, ''); // remove spaces for validation

        // --- Email validation ---
        const emailValid = email.endsWith("@@gmail.com") || email.endsWith("@@yahoo.com");
        if (!emailValid) {
            emailInput.classList.add("is-invalid");
        } else {
            emailInput.classList.remove("is-invalid");
        }

        // --- Phone validation (exactly 9 digits, ignore spaces) ---
        const phoneValid = /^\d{9}$/.test(phone);
        if (!phoneValid) {
            phoneInput.classList.add("is-invalid");
            phoneError.textContent = "Phone format has to be 123 456 789";
        } else {
            phoneInput.classList.remove("is-invalid");
            phoneError.textContent = ""; // remove message if valid
        }

        // Disable save if either field invalid
        saveButton.disabled = !emailValid || !phoneValid;
    }

    // Run on page load and whenever the user types
    validateForm();
    emailInput.addEventListener('input', validateForm);
    phoneInput.addEventListener('input', validateForm);
</script>



